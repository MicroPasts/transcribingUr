<link type="text/css" rel="stylesheet" href="http://annotorious.github.io/latest/themes/dark/annotorious-dark.css"/>
<link rel="stylesheet" href="/static/vendor/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />

<!-- Fancy box script -->
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

<!-- jQuery cookie -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js" type="text/javascript"></script>

<!-- Annotorious -->
<script src="http://annotorious.github.io/latest/annotorious.min.js" type="text/javascript"></script>
<script src="http://annotorious.github.io/latest/anno-fancybox.min.js" type="text/javascript"></script>

<!-- jquery ui -->
<script src="https://code.jquery.com/ui/1.8.1/jquery-ui.min.js" type="text/javascript"></script>

<!-- jquery form serializer -->
<script src="/static/js/vendor/jquery.serializeJSON.min.js" type="text/javascript"></script>

<div id="survey" class="modal fade" data-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Do you want to help us further?</h4>
      </div>
      <div class="modal-body">
          <p>
              Thank you for contributing one task for the project.
              We are interested in knowing how you found out about us.
          </p>
          <p>
              Could you please answer two questions in a short survey?
          </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
        <a class="btn btn-large btn-success" href="https://docs.google.com/forms/d/1Foe1CCfd4K_ZmtX2W8MDsoSjjDi5zd5DLgG7yRVn2HQ/viewform?embedded=true">Of course! Take me to the survey!</a>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div id="survey25" class="modal fade" data-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Congratulations! You have completed 25 tasks!</h4>
      </div>
      <div class="modal-body">
          <p>
              Thank you for contributing 25 tasks for the project. Now that you
              have been using MicroPasts for a while, we would like to know how
              you found it.
          </p>
          <p>
              Could you please answer a few questions in a short survey?
          </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
        <a class="btn btn-large btn-success" href="https://docs.google.com/forms/d/1WTVapZ2Qdq0AIRazG-onDrVYDtb9xAnid7LwLrR3Uqw/viewform?embedded=true">Of course! Take me to the survey!</a>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div style="display:none;margin-top:15px; height:500px;" id="oldbrowser" class="row">
    <!-- Success and Error Messages for the user -->
    <div  class="col-md-8 col-md-offset-1 alert alert-info">
        <h2>
            Browser problems!
        </h2>
        <p>
            Sorry, but your browser does not support the current application.
            If you want to contribute, please, upgrade to a modern web browser
            like the open source and free alternative
            <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or
            <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a>.
        </p>
    </div>
</div>
<!-- End of Row -->

<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Well done!</strong> You have successfully submitted your transcription. Here is another to try if you wish!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Loading next task...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>The task has been completed!</strong> Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>
            Congratulations!
        </h2>
        <p>
            You have participated in <strong>all</strong> available tasks! Thank you for your interest and help.
        </p>
        <br/>
        <img src="https://crowdfunded.micropasts.org/assets/logo-head.png" width="200" height="200"/>
        <div class="alert-actions">
            <a class="btn-default btn" href="/">Go back</a>
            <a class="btn-default btn" href="/app">or, Check other applications</a>
        </div>
    </div>

    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">X.</a>
        <strong>Error!</strong> Something went wrong, please contact the site
        administrators via the forum, Twitter, email or our Facebook page.
    </div>
</div> <!-- End Success and Error Messages for the user -->

<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->

<!-- Start Skeleton Row-->
<div class="row skeleton">

    <!-- Start of Question and Submission DIV -->

    <!-- The button groups -->
    <div class="btn-group pull-right">
        <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-eye-open"></i> Tutorial</button>
        <a class="btn btn-info btn-sm" id="imgLink" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window" href="http://community.micropasts.org/category/crowd-sourcing-support"><i class="glyphicon glyphicon-book"></i> Community Help</a>
        <a id="raw" href="" class="btn btn-sm btn-info fancybox" ><i class="glyphicon glyphicon-picture"></i> Overlay</a>
        <a id="flickr" rel="tooltip" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window" href="" class="btn btn-sm btn-info"><i class="icon icon-flickr"></i> View on Flickr</a>
        <a id="down" rel="tooltip" data-toggle="tooltip" data-placement="top" title="Only works for compliant browsers" download="" href="" class="btn btn-sm btn-info" ><i class="glyphicon glyphicon-download"></i> Download</a>
    </div>

    <!-- Annotator section -->
    <div class="btn-group">
        <button id="status" type="button" class="btn btn-default btn-type disabled" name="loading" value="loading">Loading photo</button>
        <button id="reset" type="button" class="btn btn-default btn-type">Reset annotator</button>
    </div>
    <div class="row">
        <!-- Start of Photo DIV (column) -->
        <div class="col-md-6">
            <div id="imgContainer" >
             <span id="photo-link">
                <img id="photo" src="/static/img/loading.gif" class="loadingIcon">
             </span>
            </div>
        </div>
        <!-- End of Photo DIV (column) -->
        <div class="col-md-6">
            <form id="phototagging" role="form">

                <div class="form-group">
                    <label class="control-label" for="pageType">Page type: </label>
                    <input type="text" name="pageType" id="pageType" class="form-control fields" >
                </div>

                <div class="form-group">
                    <label class="control-label" for="transcription">Transcription of page: </label>
                    <textarea class="form-control fields" rows="12" id="transcription" name="transcription" placeholder="Please transcribe the text on the page."></textarea>
                </div>

                <div class="form-group">
                     <label class="control-label" for="houseNumber">House number: </label>
                    <input type="text" name="houseNumber" id="houseNumber" class="form-control fields" placeholder="If present and often top middle">
                </div>

                <div class="form-group">
                     <label class="control-label" for="graveNumber">Grave number: </label>
                    <input type="text" name="graveNumber" id="graveNumber" class="form-control fields" placeholder="If present and often top left corner">
                </div>

                <div class="form-group">
                     <label class="control-label" for="trench">Trench: </label>
                    <input type="text" name="trench" id="trench" class="form-control fields" placeholder="If present the format is like TTF">
                </div>

                <div class="form-group">
                     <label class="control-label" for="drawings">Number of drawings: </label>
                    <input type="text" name="drawings" id="drawings" class="form-control fields" placeholder="Please enter a number">
                </div>

                <div class="btn-group">
                    <button class="btn btn-success btn-answer" value='Yes'><i class="icon icon-white icon-save"></i> Submit your answer</button>
                </div>

            </form>
        </div>
    </div>
    <!-- Feedback items for the user -->
        <p>You are working now on task: <span id="task-id" class="label label-warning">#</span></p>
        <p>You have completed: <span id="done" class="label label-info"></span> tasks from
            <!-- Progress bar for the user -->
            <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
        </div>
        <!-- End of feedback row -->

</div>


<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h3 class="lead">Transcribing Leonard Woolley's field notebooks</h3>
            </div>

            <div id="0" class="modal-body" style="display:none">
                <p>
                    In this application, the "Ur of the Chaldees: A Virtual Vision of Woolley's Excavations" project team
                    would like your help to transcribe the field notes of Leonard Woolley from the 1922 - 1934 expeditions.
                    This is not an easy task for several reasons, not least because of the hand writing and paper these
                    notes are written on.
                </p>
                <p>
                    If you follow the steps outlined in this tutorial, we will generate structured, usable data for the team.
                    The interface allows for the images to be annotated and for the written data to be transcribed into
                    the array of fields on the right.
                </p>
            </div>

            <div id="1" class="modal-body" style="display:none">
                <p>
                    These field notes present in several different ways, much less rigidly structured than some of our previous
                    projects, but none-the-less, still transcription ready. The next few steps will outline what sort of
                    information can be seen on each type of page.
                </p>
                <p>
                    The first style of page is shown below:
                </p>
                <img src="https://farm9.staticflickr.com/8685/16656874789_74b096ffc7.jpg" alt="Sample notes explained" />
            </div>

            <div id="2" class="modal-body" style="display:none">
                <p>
                    The second style of page presents as:
                </p>
                <img src="https://farm9.staticflickr.com/8663/16817133756_1950c00181.jpg" alt="Sample notes explained" />
            </div>

            <div id="3" class="modal-body" style="display:none">
                <p>
                    The third style of page presents as:
                </p>
                <img src="https://farm9.staticflickr.com/8720/16656875669_8bc1a4c6c6.jpg" alt="Sample notes explained" />
            </div>

            <div id="4">
                <p>
                    If you see an image in the text, please activate the annotation tool, draw a box around the image and
                    describe what you see; for example a harp.
                </p>
                <img src="http://micropasts.org/wp-content/uploads/2015/03/annotator.png" />
            </div>

            <div id="5" class="modal-body" style="display:none">
                <h3 class="lead">Woolley's handwriting</h3>
                <p>
                    Sir Leonard's handwriting, like so many geniuses', can be difficult to read. Making it still more
                    difficult are the quirks of his hand -- abbreviations and habits that, once recognized, make the task
                    of transcription much easier. I list some I have noticed to help recognize them. Transcribe as he
                    wrote them, not as what he meant, though:
                </p>
                <ul>
                    <li>- - the dash is most often Woolley's shorthand for the word 'the'. Transcribe it as a dash as
                        he wrote it, but the wording makes much more sense when you see what the shorthand stands for.
                    </li>
                    <li>
                        + - Woolley's symbol for 'and'. Use the ampersand (&) when transcribing it.
                    </li>
                    <li>
                        < - a symbol for the word 'angle'.
                    </li>
                    <li>
                        :. - three dots in a triangle (not directly transcribable with basic keyboard) is the mathematical symbol meaning 'therefore'. Woolley often uses this symbol for this word.
                    </li>
                    <li>
                        abt - abbreviation for the word 'about'
                    </li>
                    <li>
                        base - often used in measurements of pots, giving the diameter of the base of the vessel.
                    </li>
                    <li>
                        b.b. - burned brick (or baked brick), often used in phrases like 'beneath b.b. foundations'.
                    </li>

                    <li>
                        bet. - abbreviation for 'between'.
                    </li>

                    <li>
                        bldg - abbreviation for 'building'.
                    </li>

                    <li>
                        cd - shortening of the word 'could'.
                    </li>

                    <li>
                        d.c. - abbreviation for double conoid, a form of bead (see field note terms)
                    </li>

                    <li>
                        diam. - Woolley frequently uses this abbreviation for diameter when giving dimensions of pots.
                    </li>

                    <li>
                        foot or base - used in some cases when giving the dimension of the bottom of a pot.
                    </li>

                    </li>
                        founds - shortening of the word 'foundations'. Woolley was excavating to these and below and
                    often notes the state of the foundations of any building.
                    </li>

                    <li>
                        frs. - abbreviation for 'fragments'. It is common to find pieces of objects in archaeological
                        excavation and Woolley often uses this abbreviation to designate that.
                    </li>

                    <li>
                        grtst - shortening of the word 'greatest', used in reference to maximum measurements of objects
                        such as the greatest width (grtst w)
                    </li>

                    <li>
                        h - this is sometimes used as shorthand for 'have', particularly in expressions like 'wd h' or
                        'cd h' for 'would have' or 'could have'.
                    </li>

                    <li>
                        ht. - Woolley frequently uses this abbreviation for height when giving dimensions of objects.
                    </li>
                </ul>
            </div>

            <div id="6" style="display:none" class="modal-body">
                <ul>
                    <li>
                        l. - lower case letter 'L' used as abbreviation for the word 'length' and frequently used when
                        giving dimensions of artifacts or architecture.
                    </li>

                    <li>
                        m. or max. - abbreviation for 'maximum', often used in giving measurements at the largest point
                        of an artifact, such as maximum length (max. l.)
                    </li>

                    <li>
                        o - shorthand for the word 'of'.
                    </li>

                    <li>
                        o- - combination of 'o' = 'of' and '-' = 'the', so together they are shorthand for 'of the'.
                    </li>

                    <li>
                        pt - abbreviation of the word 'point' as in 'point of interest'
                    </li>

                    <li>
                        rim - used in many cases when giving the dimensions of pottery, denoting the size of the mouth
                        of the vessel.
                    </li>

                    <li>
                        shew - archaized version of the word 'show'. It is in Woolley's common usage throughout his
                        personal and professional writing and was common in most British work of the period.
                    </li>

                    <li>
                        t- - abbreviation of the word 'that'. Easy to confuse with 'tr' for 'there' or the word 'to'.
                        Context is the only way to tell in most cases.
                    </li>

                    <li>
                        tr - this is the way that Woolley abbreviates the word 'there'. In his hand it looks like the
                        word 'to' but context of the sentence will usually reveal its meaning.
                    </li>

                    <li>
                        U.#### - field number of an artifact. These are vital for us to connect the information of these
                        note cards to the objects now in museums. We need to be consistent in the way we reference these
                        so they can be found. Woolley often writes them in different ways, such as U10:166 but our database
                        would refer to that as U.10166. I have been placing the regularized version in brackets directly
                        after the unusual, directly transcribed form.
                    </li>

                    <li>
                        wch - Woolley's frequent abbreviation for 'which'. it looks like the word 'who' but context
                        can usually sort it out.
                    </li>

                    <li>
                        w. - typical abbreviation for 'width' when giving measurements.
                    </li>

                    <li>
                        wd - abbreviation of the word 'would'; only occasionally used. Sometimes also used as an
                        abbreviation for 'width' in measurements, but more typically that is just w.
                    </li>

                    <li>
                        v. - abbreviation for 'very'
                    </li>
                </ul>
            </div>

            <div id="7" class="modal-body" style="display:none">
                <p>
                    Like Woolley's, Mallowan's handwriting can be difficult to read. His script is quite similar in many
                    ways to Woolley's and we are still struggling at times to determine exactly which ones each of them
                    wrote, but in general, it appears that Mallowan's writing is smaller and more upright than Woolley's.
                    His lower case 'd' often looks like an upper case 'S' and he spells things out much more often than
                    Woolley does. In other words, he will say 'of the' instead of 'o-', not using the telegraph code that
                    Woolley uses to save time and space in his notes.
                </p>

                <p>Here are terms that seem specific to Mallowan:</p>
                <ul>
                   <li>
                       founds - shortening of the word foundations.
                   </li>
                   <li>
                       q.v. - abbreviation for the Latin phrase 'quode vide' which is a self reference, basically.
                       It literally translates as 'see which,' but means 'see within this text,' or 'that which I have
                       mentioned before.'
                    </li>
                    <li>
                        revil - this is the way Mallowan consistently spells the word 'reveal,' not in the sense of the verb 'to reveal' but in the sense of the architectural term for the sides of a door jamb (see field note terms).
                    </li>
                    <li>
                        wd - typical abbreviation for 'width' when giving measurements.
                    </li>
                </ul>
            </div>

            <div class="modal-footer">
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <a id="startContrib" href="../newtask" class="btn btn-primary" style="display:none"><i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
            </div>
        </div>
    </div>
</div>

<!-- End of skeleton -->
<script type="text/javascript">
        $(document).ready(function() {
            $("#acti").tooltip({
                placement: $(this).data("placement") || 'top'
            });
            $( "#reset" ).on( "click", function() {
              	anno.removeAll();
  				console.log('Reset fired');
			});
        });
</script>

<script>
    var step = -1;
    function showStep(action) {
        $("#" + step).hide();
        if (action == 'next') {
            step = step + 1;
        }
        if (action == 'prev') {
            step = step - 1;
        }
        if (step == 0) {
            $("#prevBtn").hide();
        }
        else {
            $("#prevBtn").show();
        }

        if (step == 7 ) {
            $("#nextBtn").hide();
            $("#startContrib").show();
        }
        $("#" + step).show();
    }

    showStep('next');
    $("#modal").modal('show');
</script>

<!-- Client side scripts -->
<script type="text/javascript ">
// Quick fix for IE8
Modernizr.load({
  test: window.JSON,
  nope: '/static/js/vendor/json2.min.js'
});
</script>

<script type="text/javascript">
    $(window).resize(function(){
        console.log('Window resized');
    });
</script>

 <!-- Load user progress -->
 <script type="text/javascript">
    function loadUserProgress() {
        pybossa.userProgress('urChaldees').done(function(data){
            console.log("Total answers done for user: " + data.done);
            var pct = Math.round((data.done*100)/data.total);
            $("#progress").css("width", pct.toString() +"%");
            $("#progress").attr("title", pct.toString() + "% completed!");
            $("#progress").tooltip({'placement': 'left'});
            $("#total").text(data.total);
            $("#done").text(data.done);
            $('a[rel]').tooltip({'placement': 'left'});
        });
    }
</script>

<script type="text/javascript">
    pybossa.taskLoaded(function(task, deferred) {
        if ( ! $.isEmptyObject(task) ) {
          var img = $('<img width="100%" style="height:auto;" />');
            img.load(function() {
                // continue as soon as the image is loaded
                deferred.resolve(task);
                $("#status").text("Photo loaded!");
            });
            img.attr('src', task.info.url_b);
            img.attr('id', 'anno_' + task.id);
            img.addClass('img-polaroid');
            img.addClass('annotable');
            task.info.image = img;
            console.log('Task ID: ' + task.id);
        }
        else {
            deferred.resolve(task);
        }
    });
</script>

<script type="text/javascript">
    pybossa.presentTask(function(task, deferred) {
        if ( !$.isEmptyObject(task) ) {
            loadUserProgress();
            console.log(task);
            $('#photo-link').html('').append(task.info.image);
            $('#task-id').html(task.id);
            $("a#raw").attr("href", task.info.url_b);
            $("a#flickr").attr("href", task.info.link + '/sizes/k/');
            $("a#down").attr("download", task.id);
            $("a#down").attr("href", task.info.url_b );
            $(".fancybox").fancybox();
            $('#imgLink').tooltip();
            $("[rel=tooltip]").tooltip();
            anno.makeAnnotatable(document.getElementById('anno_' + task.id));
            anno.addHandler('onAnnotationCreated', function(annotation) {
                console.log(annotation.text);
                $(".btn-answer").html("<i class='icon icon-save'></i> Save current annotations");
                $(".btn-answer").addClass("btn-success");
            });
            $('.btn-answer').off('click').on('click', function(evt) {
                evt.preventDefault();
                var answer = $(evt.target).attr("value");
                if (typeof answer != 'undefined') {
                    task.answer = $("#phototagging").serializeJSON();
                    task.answer.pageType = $('#pageType').val();
                    task.answer.transcription = $('#transcription').val();
                    task.answer.houseNumber = $('#houseNumber').val();
                    task.answer.graveNumber = $('#graveNumber').val();
                    task.answer.trench = $('#trench').val();
                    task.answer.drawings = $('#drawings').val();
                    task.answer.annotations = anno.getAnnotations();
                    console.log(task.answer);
                    pybossa.saveTask(task.id, task.answer).done(function() {
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        $("#success").fadeIn(500).fadeOut(500);
                        $("#loading").fadeIn(500).fadeOut(500);
                        $('.fields').val('');
                        deferred.resolve();
                    });
                } else {
                    $("#error").show();
                }
            });
            $("#loading").hide();
        } else {
            $(".skeleton").hide();
            $("#loading").hide();
            $("#finish").fadeIn(500);
        }
    });
    pybossa.run('urChaldees');
    </script>

<!-- App specific styles -->
<style>
    .messageMargin {
        margin-top: 15px;
    }
    .loadingIcon {
        max-width:100%;
    }
    .none {
        display:none;
    }
    .ui-autocomplete {
        background-color: white;
        width: 300px;
        border: 1px solid #cfcfcf;
        list-style-type: none;
        padding: 10px;
    }
    .multiselect-container {
        max-height: 250px;
        overflow-y: auto;
        overflow-x: hidden;
    }
    #map {
        height:400px;
        width:100%;
        margin-top: 15px;
    }
    #keywords .btn-group {
        margin-top: 0px;
        margin-bottom: 0px;
    }
    .row {
        margin-left: 0px;
        margin-right: 0px;
    }
</style>